const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SceneMap.js","../run.js"])))=>i.map(i=>d[i]);
import{A as h,D as g,_ as m,S as d,L as l,a as f}from"../run.js";class c{#t;constructor(t){this.#t=t}get(t){for(const[e,s]of Object.entries(this.#t))if(new RegExp(`^${e}$`).test(t))return s}*getAll(t){for(const[e,s]of Object.entries(this.#t))new RegExp(`^${e}$`).test(t)&&(yield s)}getKeys(){return Object.keys(this.#t)}getValues(){return Object.values(this.#t)}add(t,e){this.#t[t]=e}}class i{static#t=250;static#e=250;pages=new c({});#i=new c({});#n=new c({});#c=new c({});#r;#s=[];#a="first";#o=!1;async load(t,e,{history:s}={}){if(this.#o)throw new Error("Pages have already been loaded");this.#o=!0,this.#r=t,this.#r.innerHTML=e;const a=s&&s.length?s.at(-1):"first";this.#s=s&&s.length?s.slice(0,-1):[],t.querySelectorAll(".page").forEach(n=>{this.pages.add(n.id,n),n.classList.add("hidden")}),await this.goto(a,{msIn:0,msOut:0}),this.setupButtonsOnclick()}getCurrentPageId(){return this.#a}on(t,e){this.#i.add(t,e)}onLeft(t,e){this.#n.add(t,e)}before(t,e){this.#c.add(t,e)}setupButtonsOnclick(){this.#r.querySelectorAll("[data-back]").forEach(this.#l.bind(this)),this.#r.querySelectorAll("[data-link]").forEach(this.#h.bind(this))}#l(t){const e=Number(t.dataset.back)||1,s=o(t.dataset["ms-in"],i.#t),a=o(t.dataset["ms-Out"],i.#e);t.onclick=()=>{this.back(e,{msIn:s,msOut:a})}}#h(t){const e=t.dataset.link||"first",s=o(t.dataset["ms-in"],i.#t),a=o(t.dataset["ms-Out"],i.#e);t.onclick=()=>{this.goto(e,{msIn:s,msOut:a})}}async back(t,e={}){for(let s=0;s<t;s++)await this.#u(e)}async#u(t={}){this.#s.length!==0&&(this.#s.pop(),await this.goto(this.#s.pop(),t))}async goto(t,{msIn:e=i.#t,msOut:s=i.#e}={}){if(await this.#d(t))return;this.#f(this.#a);const a=this.pages.get(this.#a),n=this.pages.get(t);a&&(await h.fadeOut(a,s),a.classList.add("hidden")),this.#s.push(t),this.#a=t,this.#g(this.#a),n&&(n.classList.remove("hidden"),await h.fadeIn(n,e))}async#d(t){const e=this.#c.getAll(t).map(a=>a(this));return(await Promise.all(e)).some(Boolean)}#f(t){this.#n.getAll(t).map(e=>e(this))}#g(t){requestAnimationFrame(()=>{this.#i.getAll(t).forEach(e=>e(this))})}}function o(r,t){return!r||Number.isNaN(Number(r))?t:Number(r)}class p{async end(){}}class u extends p{ready;#t=new i;constructor(){super(),this.ready=this.#e()}async#e(){const t=await fetch("pages/title.html").then(e=>e.text());await this.#t.load(g.container,t),this.#n(),this.#t.on(".*",e=>{e.pages.get(e.getCurrentPageId())}),this.#t.before("start",async e=>{const{SceneMap:s}=await m(async()=>{const{SceneMap:a}=await import("./SceneMap.js");return{SceneMap:a}},__vite__mapDeps([0,1]),import.meta.url);return await d.goto(()=>new s(0)),l.getFlags().includes("始まり")||this.#i(),!0}),this.#t.before("delete-data",async()=>(await f.ask("ほんとに?",["はい","いいえ"])===0&&(l.clear(),d.goto(()=>new u)),!0)),this.#t.before("fullscreen",async e=>(document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen(),!0))}async#i(){l.addFlag("始まり");const t=await fetch("../../assets/stories/始まり.json").then(e=>e.json());await f.say(...t)}#n(){const t=this.#t.pages.get("first");h.ok().then(()=>{t.classList.add("show")})}}const y=Object.freeze(Object.defineProperty({__proto__:null,SceneTitle:u},Symbol.toStringTag,{value:"Module"}));export{i as P,p as S,y as a};
//# sourceMappingURL=SceneTitle.js.map
