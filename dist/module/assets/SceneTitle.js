const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SceneMap.js","../run.js"])))=>i.map(i=>d[i]);
import{T as w,A as f,D as d,B as o,L as n,S as m,_ as g,a as y}from"../run.js";class c{#t;#e;constructor(t,e=.5){this.#t=new Audio(t),this.#e=e,this.#t.volume=e,this.#t.preload="auto"}get duration(){return this.#t.duration}play(){this.#t.currentTime=0,this.#t.play()}setVolume(t){this.#t.volume=t*this.#e}}class l{static clear=new c("assets/sounds/se/clear.mp3",1);static move=new c("assets/sounds/se/マウススプレー・口内.mp3",.5);static reset=new c("assets/sounds/se/窓を開ける.mp3",1);static switch=new c("assets/sounds/se/引き戸を閉める.mp3",1);static click=new c("assets/sounds/se/カーソル移動2.mp3",1);static suzu=new c("assets/sounds/se/鈴が鳴る.mp3",1);static kansei=new c("assets/sounds/se/歓声.mp3",1);static setVolume(t){Object.values(this).forEach(e=>{e.setVolume(t)})}}class h{#t;constructor(t={}){this.#t=t}get(t){for(const[e,s]of Object.entries(this.#t))if(new RegExp(`^${e}$`).test(t))return s}*getAll(t){for(const[e,s]of Object.entries(this.#t))new RegExp(`^${e}$`).test(t)&&(yield s)}getKeys(){return Object.keys(this.#t)}getValues(){return Object.values(this.#t)}add(t,e){this.#t[t]=e}}class b{container;pages=new h({});ready;constructor(t,e){this.container=t,this.ready=this.setup(e)}async fadeOut(t,{msOut:e}){const s=this.getPage(t);await w.fadeOut(s,e),s.classList.add("hidden")}async fadeIn(t,{msIn:e}){const s=this.getPage(t);s.classList.remove("hidden"),await w.fadeIn(s,e)}getPage(t,e={}){const s=this.pages.get(t);if(e.noError)return s;if(!s)throw new Error("存在しないページを得ようとした。");return s}async setup(t){this.container.style.display="none",this.container.innerHTML=t,Array.from(this.container.querySelectorAll(".page")).filter(e=>e instanceof HTMLElement).forEach(e=>{this.pages.add(e.id,e),e.classList.add("hidden")}),await Promise.all([f.waitCSSLoad(this.container),f.waitElementReady(this.container)]),this.container.style.display=""}}class T{onEnterHandlers=new h;onLeftHandlers=new h;beforeEnterHandlers=new h;setOnEnter(t,e){this.onEnterHandlers.add(t,e)}setOnLeft(t,e){this.onLeftHandlers.add(t,e)}setBeforeEnter(t,e){this.beforeEnterHandlers.add(t,e)}onEnter(t,e){return Promise.all(this.onEnterHandlers.getAll(e).map(s=>s(t)))}onLeft(t,e){return Promise.all(this.onLeftHandlers.getAll(e).map(s=>s(t)))}async beforeEnter(t,e){const s=Array.from(this.beforeEnterHandlers.getAll(e).map(S=>S(t)));return s.length===0?!0:(await Promise.all(s)).every(Boolean)}}class L{currentPageId="first";history=[];transitioning=!1;constructor(t){const e=t&&t.length?t.at(-1):"first";this.history=t&&t.length?t.slice(0,-1):[],this.currentPageId=e}goto(t){this.history.push(t),this.currentPageId=t}back(t){if(this.history.length<=t)return this.history=[],"first";for(let e=0;e<t;e++)this.history.pop();return this.history.pop()}isTransitioning(){return this.transitioning}startTransition(){if(this.transitioning)throw new Error("Pages向けのError: 状態移行中に別の移行を始めようとした。");this.transitioning=!0}endTransition(){if(!this.transitioning)throw new Error("Pages向けのError: 状態移行中じゃあないのに状態変化を終わらせようとした。");this.transitioning=!1}}class i{static DEFAULT_IN_MS=250;static DEFAULT_OUT_MS=250;dom;state;run=new T;onEnter=this.run.setOnEnter.bind(this.run);onLeft=this.run.setOnLeft.bind(this.run);beforeEnter=this.run.setBeforeEnter.bind(this.run);async loadFromFile(t,e,s={}){const r=await fetch(e).then(E=>E.text());await this.load(t,r,s)}async load(t,e,{history:s}={}){if(this.dom)throw new Error("Pages have already been loaded");this.state=new L(s),this.dom=new b(t,e),await this.dom.ready,this.setupButtonsOnclick(),await this.goto(this.state.currentPageId,{msIn:0,msOut:0})}getPage(t,e={}){return e.noError?this.dom.getPage(t,{noError:!0}):this.dom.getPage(t)}getCurrentPage(){return this.dom.getPage(this.state.currentPageId)}getCurrentPageId(){return this.state.currentPageId}setupButtonsOnclick(){this.dom.container.querySelectorAll("[data-link]").forEach(this.setupLinkButton.bind(this)),this.dom.container.querySelectorAll("[data-back]").forEach(this.setupBackButton.bind(this))}setupLinkButton(t){const e=t.dataset.link||"first",s=u(t.dataset.msIn,i.DEFAULT_IN_MS),r=u(t.dataset.msOut,i.DEFAULT_OUT_MS);t.onclick=()=>this.goto(e,{msIn:s,msOut:r})}setupBackButton(t){const e=Number(t.dataset.back)||1,s=u(t.dataset.msIn,i.DEFAULT_IN_MS),r=u(t.dataset.msOut,i.DEFAULT_OUT_MS);t.onclick=()=>this.back(e,{msIn:s,msOut:r})}async back(t,e={}){await this.goto(this.state.back(t),e)}async goto(t,{msIn:e=i.DEFAULT_IN_MS,msOut:s=i.DEFAULT_OUT_MS}={}){if(this.state.isTransitioning())return;if(this.state.startTransition(),!await this.run.beforeEnter(this,t)){this.state.endTransition();return}await this.dom.fadeOut(this.state.currentPageId,{msOut:s}),await this.run.onLeft(this,this.state.currentPageId),this.state.goto(t),await this.run.onEnter(this,t),await this.dom.fadeIn(t,{msIn:e}),this.state.endTransition()}}function u(a,t){return!a||Number.isNaN(Number(a))?t:Number(a)}class P{async end(){}}class p extends P{ready;#t=new i;constructor(){super(),this.ready=this.#e()}async#e(){await this.#t.loadFromFile(d.container,"assets/pages/title.html"),this.#a(),this.#i(),this.#r(),this.#s(),this.#c()}#s(){this.#t.beforeEnter("start",async t=>{l.suzu.play(),o.pause(),o.unload("assets/sounds/bgm/信仰の残り香.mp3"),o.change("assets/sounds/bgm/仲介行脚.mp3",{loop:!0,loopEndS:118.125}),n.getFlags().includes("始まり")?await m.goto(()=>g(async()=>{const{SceneMap:e}=await import("./SceneMap.js").then(s=>s.S);return{SceneMap:e}},__vite__mapDeps([0,1]),import.meta.url).then(({SceneMap:e})=>new e(0))):await m.goto(()=>g(async()=>{const{SceneMap:e}=await import("./SceneMap.js").then(s=>s.S);return{SceneMap:e}},__vite__mapDeps([0,1]),import.meta.url).then(({SceneMap:e})=>new e(0)),{msIn:1800,msOut:1800,afterLoad:async()=>{this.#n()}})}),this.#t.beforeEnter("delete-data",async()=>{await y.ask("ほんとに?",["はい","いいえ"])===0&&(n.clear(),m.goto(async()=>new p))}),this.#t.beforeEnter("fullscreen",t=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()})}async#n(){n.addFlag("始まり");const t=await g(()=>import("./event.js"),[],import.meta.url);await y.say(...t.default.始まり)}#a(){const t=this.#t.getPage("first");o.fadeOut(),f.ok().then(()=>{t.classList.add("show"),o.change("assets/sounds/bgm/信仰の残り香.mp3"),this.#o()})}#i(){const t=this.#t.getPage("setting"),e=t.querySelector("#bgm-volume"),s=t.querySelector("#se-volume");e.value=String(n.getBGMVolume()),s.value=String(n.getSEVolume()),o.setVolume(n.getBGMVolume()/9),l.setVolume(n.getSEVolume()/9),e.oninput=()=>{n.setBGMVolume(+e.value),o.setVolume(n.getBGMVolume()/9)},s.oninput=()=>{n.setSEVolume(+s.value),l.setVolume(n.getSEVolume()/9),l.move.play()}}#r(){}#o(){const t=d.container;for(let e=0;e<30;e++){const s=document.createElement("div");s.classList.add("particle"),s.style.left=`${Math.random()*100}%`,s.style.width=`${20+Math.random()*30}px`,s.style.height=s.style.width,s.style.animationDuration=`${5+Math.random()*5}s`,s.style.animationDelay=`${Math.random()*10}s`,t.appendChild(s)}}#c(){n.getStageData().every(t=>t.cleared)&&d.container.querySelector("[data-link=story]")?.classList.remove("hidden")}}const O=Object.freeze(Object.defineProperty({__proto__:null,SceneTitle:p},Symbol.toStringTag,{value:"Module"}));export{i as P,P as S,l as a,O as b};
//# sourceMappingURL=SceneTitle.js.map
