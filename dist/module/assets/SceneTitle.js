const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SceneMap.js","../run.js"])))=>i.map(i=>d[i]);
import{A as g,D as f,_ as w,S as y,L as n,a as S}from"../run.js";class l{#t;#e;constructor(t,e=.5){this.#t=new Audio(t),this.#e=e,this.#t.volume=e}get duration(){return this.#t.duration}play(){this.#t.currentTime=0,this.#t.play()}setVolume(t){this.#t.volume=t*this.#e}}class u{static clear=new l("assets/sounds/se/clear.mp3",1);static move=new l("assets/sounds/se/マウススプレー・口内.mp3",.5);static reset=new l("assets/sounds/se/窓を開ける.mp3",1);static switch=new l("assets/sounds/se/引き戸を閉める.mp3",1);static click=new l("assets/sounds/se/カーソル移動2.mp3",1);static setVolume(t){Object.values(this).forEach(e=>{e.setVolume(t)})}}class i{static context=new AudioContext;static wholeGain=this.context.createGain();static#t=1;static#e=null;static{this.wholeGain.connect(this.context.destination)}#o;#a;#r=1;#i;#s=null;#n=!1;constructor(t,e){this.#o=t,this.#r=e.volume??1,this.#a=i.context.createGain(),this.#a.gain.value=this.#r,this.#a.connect(i.wholeGain),this.#i=this.#c(e)}async#c(t){const s=await(await fetch(this.#o)).arrayBuffer(),a=await i.context.decodeAudioData(s);this.#s=i.context.createBufferSource(),this.#s.buffer=a,this.#s.loopStart=t.loopStartS??0,this.#s.loopEnd=t.loopEndS??a.duration,this.#s.loop=t.loop??!0,this.#s.connect(this.#a)}async#u(t){this.#a.gain.setValueAtTime(this.#r,i.context.currentTime),this.#a.gain.linearRampToValueAtTime(0,i.context.currentTime+t/1e3),await new Promise(e=>setTimeout(e,t)),this.#a.disconnect(),this.#n&&this.#s?.stop(),this.#s?.disconnect()}static getPath(){return this.#e?this.#e.#o:""}static async ffp(t,e={}){await Promise.all([this.fadeOut(1e3),this.#h(t,e)]),this.getPath()===t&&this.#d(e.when??0)}static async#h(t,e){this.#e=new i(t,e),await this.#e.#i}static#d(t){this.#e&&(this.#e.#s?.start(this.context.currentTime+t),this.#e.#n=!0)}static setVolume(t){this.#t=t,this.wholeGain.gain.value=this.#t}static async fadeOut(t){this.#e&&await this.#e.#u(t)}}window.BGM=i;class h{#t;constructor(t){this.#t=t}get(t){for(const[e,s]of Object.entries(this.#t))if(new RegExp(`^${e}$`).test(t))return s}*getAll(t){for(const[e,s]of Object.entries(this.#t))new RegExp(`^${e}$`).test(t)&&(yield s)}getKeys(){return Object.keys(this.#t)}getValues(){return Object.values(this.#t)}add(t,e){this.#t[t]=e}}class r{static#t=250;static#e=250;pages=new h({});#o=new h({});#a=new h({});#r=new h({});#i;#s=[];#n="first";#c=!1;async loadFromFile(t,e,s={}){const a=await fetch(e).then(o=>o.text());await this.load(t,a,s)}async load(t,e,{history:s}={}){if(this.#c)throw new Error("Pages have already been loaded");this.#c=!0,this.#i=t,this.#i.innerHTML=e;const a=s&&s.length?s.at(-1):"first";this.#s=s&&s.length?s.slice(0,-1):[],t.querySelectorAll(".page").forEach(o=>{this.pages.add(o.id,o),o.classList.add("hidden")}),await this.goto(a,{msIn:0,msOut:0}),this.setupButtonsOnclick()}getCurrentPage(){return this.pages.get(this.#n)}getCurrentPageId(){return this.#n}on(t,e){this.#o.add(t,e)}onLeft(t,e){this.#a.add(t,e)}before(t,e){this.#r.add(t,e)}setupButtonsOnclick(){this.#i.querySelectorAll("[data-back]").forEach(this.#u.bind(this)),this.#i.querySelectorAll("[data-link]").forEach(this.#h.bind(this))}#u(t){const e=Number(t.dataset.back)||1,s=d(t.dataset["ms-in"],r.#t),a=d(t.dataset["ms-Out"],r.#e);t.onclick=async()=>{this.#l(!1),await this.back(e,{msIn:s,msOut:a}),this.#l(!0)}}#h(t){const e=t.dataset.link||"first",s=d(t.dataset["ms-in"],r.#t),a=d(t.dataset["ms-Out"],r.#e);t.onclick=async()=>{this.#l(!1),await this.goto(e,{msIn:s,msOut:a}),this.#l(!0)}}async back(t,e={}){for(let s=0;s<t;s++)await this.#d(e)}async#d(t={}){this.#s.length!==0&&(this.#s.pop(),await this.goto(this.#s.pop(),t))}async goto(t,{msIn:e=r.#t,msOut:s=r.#e}={}){if(await this.#m(t))return;this.#f(this.#n);const o=this.pages.get(this.#n),m=this.pages.get(t);o&&(await g.fadeOut(o,s),o.classList.add("hidden")),this.#s.push(t),this.#n=t,this.#g(this.#n),m&&(m.classList.remove("hidden"),await g.fadeIn(m,e))}async#m(t){const e=this.#r.getAll(t).map(a=>a(this));return(await Promise.all(e)).some(Boolean)}#f(t){this.#a.getAll(t).map(e=>e(this))}#g(t){requestAnimationFrame(()=>{this.#o.getAll(t).forEach(e=>e(this))})}#l(t){const e=this.getCurrentPage();e&&e.querySelectorAll("[data-link], [data-back]").forEach(s=>{s.style.pointerEvents=t?"":"none"})}}function d(c,t){return!c||Number.isNaN(Number(c))?t:Number(c)}class b{async end(){}}class p extends b{ready;#t=new r;constructor(){super(),this.ready=this.#e()}async#e(){await this.#t.loadFromFile(f.container,"assets/pages/title.html"),this.#a(),this.#r(),this.#i(),this.#t.before("start",async t=>{const{SceneMap:e}=await w(async()=>{const{SceneMap:s}=await import("./SceneMap.js");return{SceneMap:s}},__vite__mapDeps([0,1]),import.meta.url);return await y.goto(()=>new e(0)),n.getFlags().includes("始まり")||this.#o(),!0}),this.#t.before("delete-data",async()=>(await S.ask("ほんとに?",["はい","いいえ"])===0&&(n.clear(),y.goto(()=>new p)),!0)),this.#t.before("fullscreen",async t=>(document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen(),!0))}async#o(){n.addFlag("始まり");const t=await w(()=>import("./event.js"),[],import.meta.url);await S.say(...t.default.始まり)}#a(){const t=this.#t.pages.get("first");i.fadeOut(1e3),g.ok().then(()=>{t.classList.add("show"),i.ffp("assets/sounds/bgm/信仰の残り香.mp3"),this.#s()})}#r(){const t=this.#t.pages.get("setting"),e=t.querySelector("#bgm-volume"),s=t.querySelector("#se-volume");e.value=String(n.getBGMVolume()),s.value=String(n.getSEVolume()),i.setVolume(n.getBGMVolume()/9),u.setVolume(n.getSEVolume()/9),e.oninput=()=>{n.setBGMVolume(+e.value),i.setVolume(n.getBGMVolume()/9)},s.oninput=()=>{n.setSEVolume(+s.value),u.setVolume(n.getSEVolume()/9),u.move.play()}}#i(){f.container.querySelectorAll("button").forEach(t=>{t.addEventListener("click",()=>{u.click.play()})})}#s(){const t=f.container;for(let e=0;e<30;e++){const s=document.createElement("div");s.classList.add("particle"),s.style.left=`${Math.random()*100}%`,s.style.width=`${20+Math.random()*30}px`,s.style.height=s.style.width,s.style.animationDuration=`${5+Math.random()*5}s`,s.style.animationDelay=`${Math.random()*10}s`,t.appendChild(s)}}}const v=Object.freeze(Object.defineProperty({__proto__:null,SceneTitle:p},Symbol.toStringTag,{value:"Module"}));export{i as B,r as P,b as S,u as a,v as b};
//# sourceMappingURL=SceneTitle.js.map
