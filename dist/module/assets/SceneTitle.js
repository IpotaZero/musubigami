const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SceneMap.js","../run.js"])))=>i.map(i=>d[i]);
import{A as g,D as d,_ as f,S as c,B as l,L as n,a as m,b as y}from"../run.js";class u{#t;constructor(t){this.#t=t}get(t){for(const[e,s]of Object.entries(this.#t))if(new RegExp(`^${e}$`).test(t))return s}*getAll(t){for(const[e,s]of Object.entries(this.#t))new RegExp(`^${e}$`).test(t)&&(yield s)}getKeys(){return Object.keys(this.#t)}getValues(){return Object.values(this.#t)}add(t,e){this.#t[t]=e}}class i{static#t=250;static#n=250;pages=new u({});#i=new u({});#r=new u({});#o=new u({});#e;#s=[];#a="first";#l=!1;async loadFromFile(t,e,s={}){const a=await fetch(e).then(o=>o.text());await this.load(t,a,s)}async load(t,e,{history:s}={}){if(this.#l)throw new Error("Pages have already been loaded");this.#l=!0,this.#e=t,this.#e.innerHTML=e,this.#e.style.display="none",await w(this.#e),this.#e.style.display="";const a=s&&s.length?s.at(-1):"first";this.#s=s&&s.length?s.slice(0,-1):[],Array.from(t.querySelectorAll(".page")).filter(o=>o instanceof HTMLElement).forEach(o=>{this.pages.add(o.id,o),o.classList.add("hidden")}),await this.goto(a,{msIn:0,msOut:0}),this.setupButtonsOnclick()}getCurrentPage(){return this.pages.get(this.#a)}getCurrentPageId(){return this.#a}on(t,e){this.#i.add(t,e)}onLeft(t,e){this.#r.add(t,e)}before(t,e){this.#o.add(t,e)}setupButtonsOnclick(){this.#e.querySelectorAll("[data-back]").forEach(this.#u.bind(this)),this.#e.querySelectorAll("[data-link]").forEach(this.#h.bind(this))}#u(t){const e=Number(t.dataset.back)||1,s=h(t.dataset["ms-in"],i.#t),a=h(t.dataset["ms-Out"],i.#n);t.onclick=async()=>{this.#c(!1),await this.back(e,{msIn:s,msOut:a}),this.#c(!0)}}#h(t){const e=t.dataset.link||"first",s=h(t.dataset["ms-in"],i.#t),a=h(t.dataset["ms-Out"],i.#n);t.onclick=async()=>{this.#c(!1),await this.goto(e,{msIn:s,msOut:a}),this.#c(!0)}}async back(t,e={}){for(let s=0;s<t;s++)await this.#d(e)}async#d(t={}){this.#s.length!==0&&(this.#s.pop(),await this.goto(this.#s.pop(),t))}async goto(t,e={}){const{msIn:s=i.#t,msOut:a=i.#n}=e;await this.#f(t)||(await this.#m(a),this.#g(t),await this.#p(t,s))}async#m(t){this.#y(this.#a);const e=this.getCurrentPage();e&&(await g.fadeOut(e,t),e.classList.add("hidden"))}#g(t){this.#s.push(t),this.#a=t}async#p(t,e){this.#w(t);const s=this.pages.get(t);s&&(s.classList.remove("hidden"),await g.fadeIn(s,e))}async#f(t){const e=this.#o.getAll(t).map(a=>a(this));return(await Promise.all(e)).some(Boolean)}#y(t){this.#r.getAll(t).map(e=>e(this))}#w(t){requestAnimationFrame(()=>{this.#i.getAll(t).forEach(e=>e(this))})}#c(t){const e=this.getCurrentPage();e&&e.querySelectorAll("[data-link], [data-back]").forEach(s=>{s.style.pointerEvents=t?"":"none"})}}function h(r,t){return!r||Number.isNaN(Number(r))?t:Number(r)}function w(r){const t=Array.from(r.querySelectorAll('link[rel="stylesheet"]'));return Promise.all(t.map(e=>e.sheet?Promise.resolve():new Promise(s=>{e.onload=s,e.onerror=s})))}class S{async end(){}}class p extends S{ready;#t=new i;constructor(){super(),this.ready=this.#n()}async#n(){await this.#t.loadFromFile(d.container,"assets/pages/title.html"),this.#o(),this.#e(),this.#s(),this.#i(),this.#l()}#i(){this.#t.before("start",async t=>{const{SceneMap:e}=await f(async()=>{const{SceneMap:s}=await import("./SceneMap.js").then(a=>a.S);return{SceneMap:s}},__vite__mapDeps([0,1]),import.meta.url);return c.suzu.play(),l.pause(),l.unload("assets/sounds/bgm/信仰の残り香.mp3"),l.change("assets/sounds/bgm/仲介行脚.mp3",{loop:!0,loopEndS:118.125}),n.getFlags().includes("始まり")?await m.goto(()=>new e(0)):await m.goto(()=>new e(0),{msIn:1800,msOut:1800,afterLoad:async()=>{this.#r()}}),!0}),this.#t.before("delete-data",async()=>(await y.ask("ほんとに?",["はい","いいえ"])===0&&(n.clear(),m.goto(()=>new p)),!0)),this.#t.before("fullscreen",async t=>(document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen(),!0))}async#r(){n.addFlag("始まり");const t=await f(()=>import("./event.js"),[],import.meta.url);await y.say(...t.default.始まり)}#o(){const t=this.#t.pages.get("first");l.fadeOut(),g.ok().then(()=>{t.classList.add("show"),l.change("assets/sounds/bgm/信仰の残り香.mp3"),this.#a()})}#e(){const t=this.#t.pages.get("setting"),e=t.querySelector("#bgm-volume"),s=t.querySelector("#se-volume");e.value=String(n.getBGMVolume()),s.value=String(n.getSEVolume()),l.setVolume(n.getBGMVolume()/9),c.setVolume(n.getSEVolume()/9),e.oninput=()=>{n.setBGMVolume(+e.value),l.setVolume(n.getBGMVolume()/9)},s.oninput=()=>{n.setSEVolume(+s.value),c.setVolume(n.getSEVolume()/9),c.move.play()}}#s(){}#a(){const t=d.container;for(let e=0;e<30;e++){const s=document.createElement("div");s.classList.add("particle"),s.style.left=`${Math.random()*100}%`,s.style.width=`${20+Math.random()*30}px`,s.style.height=s.style.width,s.style.animationDuration=`${5+Math.random()*5}s`,s.style.animationDelay=`${Math.random()*10}s`,t.appendChild(s)}}#l(){n.getStageData().every(t=>t.cleared)&&d.container.querySelector("[data-link=story]")?.classList.remove("hidden")}}const E=Object.freeze(Object.defineProperty({__proto__:null,SceneTitle:p},Symbol.toStringTag,{value:"Module"}));export{i as P,S,E as a};
//# sourceMappingURL=SceneTitle.js.map
