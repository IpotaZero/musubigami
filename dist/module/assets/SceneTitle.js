const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SceneMap.js","../run.js"])))=>i.map(i=>d[i]);
import{A as p,D as m,_ as y,B as l,L as i,S as g,a as w}from"../run.js";class c{#t;#s;constructor(t,e=.5){this.#t=new Audio(t),this.#s=e,this.#t.volume=e}get duration(){return this.#t.duration}play(){this.#t.currentTime=0,this.#t.play()}setVolume(t){this.#t.volume=t*this.#s}}class u{static clear=new c("assets/sounds/se/clear.mp3",1);static move=new c("assets/sounds/se/マウススプレー・口内.mp3",.5);static reset=new c("assets/sounds/se/窓を開ける.mp3",1);static switch=new c("assets/sounds/se/引き戸を閉める.mp3",1);static click=new c("assets/sounds/se/カーソル移動2.mp3",1);static suzu=new c("assets/sounds/se/鈴が鳴る.mp3",1);static setVolume(t){Object.values(this).forEach(e=>{e.setVolume(t)})}}class h{#t;constructor(t){this.#t=t}get(t){for(const[e,s]of Object.entries(this.#t))if(new RegExp(`^${e}$`).test(t))return s}*getAll(t){for(const[e,s]of Object.entries(this.#t))new RegExp(`^${e}$`).test(t)&&(yield s)}getKeys(){return Object.keys(this.#t)}getValues(){return Object.values(this.#t)}add(t,e){this.#t[t]=e}}class r{static#t=250;static#s=250;pages=new h({});#n=new h({});#r=new h({});#o=new h({});#e;#a=[];#i="first";#l=!1;async loadFromFile(t,e,s={}){const a=await fetch(e).then(o=>o.text());await this.load(t,a,s)}async load(t,e,{history:s}={}){if(this.#l)throw new Error("Pages have already been loaded");this.#l=!0,this.#e=t,this.#e.innerHTML=e,this.#e.style.display="none",await S(this.#e),this.#e.style.display="";const a=s&&s.length?s.at(-1):"first";this.#a=s&&s.length?s.slice(0,-1):[],Array.from(t.querySelectorAll(".page")).filter(o=>o instanceof HTMLElement).forEach(o=>{this.pages.add(o.id,o),o.classList.add("hidden")}),await this.goto(a,{msIn:0,msOut:0}),this.setupButtonsOnclick()}getCurrentPage(){return this.pages.get(this.#i)}getCurrentPageId(){return this.#i}on(t,e){this.#n.add(t,e)}onLeft(t,e){this.#r.add(t,e)}before(t,e){this.#o.add(t,e)}setupButtonsOnclick(){this.#e.querySelectorAll("[data-back]").forEach(this.#u.bind(this)),this.#e.querySelectorAll("[data-link]").forEach(this.#h.bind(this))}#u(t){const e=Number(t.dataset.back)||1,s=d(t.dataset["ms-in"],r.#t),a=d(t.dataset["ms-Out"],r.#s);t.onclick=async()=>{this.#c(!1),await this.back(e,{msIn:s,msOut:a}),this.#c(!0)}}#h(t){const e=t.dataset.link||"first",s=d(t.dataset["ms-in"],r.#t),a=d(t.dataset["ms-Out"],r.#s);t.onclick=async()=>{this.#c(!1),await this.goto(e,{msIn:s,msOut:a}),this.#c(!0)}}async back(t,e={}){for(let s=0;s<t;s++)await this.#d(e)}async#d(t={}){this.#a.length!==0&&(this.#a.pop(),await this.goto(this.#a.pop(),t))}async goto(t,e={}){const{msIn:s=r.#t,msOut:a=r.#s}=e;await this.#f(t)||(await this.#m(a),this.#g(t),await this.#p(t,s))}async#m(t){this.#y(this.#i);const e=this.getCurrentPage();e&&(await p.fadeOut(e,t),e.classList.add("hidden"))}#g(t){this.#a.push(t),this.#i=t}async#p(t,e){this.#w(t);const s=this.pages.get(t);s&&(s.classList.remove("hidden"),await p.fadeIn(s,e))}async#f(t){const e=this.#o.getAll(t).map(a=>a(this));return(await Promise.all(e)).some(Boolean)}#y(t){this.#r.getAll(t).map(e=>e(this))}#w(t){requestAnimationFrame(()=>{this.#n.getAll(t).forEach(e=>e(this))})}#c(t){const e=this.getCurrentPage();e&&e.querySelectorAll("[data-link], [data-back]").forEach(s=>{s.style.pointerEvents=t?"":"none"})}}function d(n,t){return!n||Number.isNaN(Number(n))?t:Number(n)}function S(n){const t=Array.from(n.querySelectorAll('link[rel="stylesheet"]'));return Promise.all(t.map(e=>e.sheet?Promise.resolve():new Promise(s=>{e.onload=s,e.onerror=s})))}class b{async end(){}}class f extends b{ready;#t=new r;constructor(){super(),this.ready=this.#s()}async#s(){await this.#t.loadFromFile(m.container,"assets/pages/title.html"),this.#o(),this.#e(),this.#a(),this.#n(),this.#l()}#n(){this.#t.before("start",async t=>{const{SceneMap:e}=await y(async()=>{const{SceneMap:s}=await import("./SceneMap.js").then(a=>a.S);return{SceneMap:s}},__vite__mapDeps([0,1]),import.meta.url);return u.suzu.play(),l.stop(),l.unload("assets/sounds/bgm/信仰の残り香.mp3"),i.getFlags().includes("始まり")?await g.goto(()=>new e(0)):await g.goto(()=>new e(0),{msIn:1800,msOut:1800,afterLoad:async()=>{this.#r()}}),!0}),this.#t.before("delete-data",async()=>(await w.ask("ほんとに?",["はい","いいえ"])===0&&(i.clear(),g.goto(()=>new f)),!0)),this.#t.before("fullscreen",async t=>(document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen(),!0))}async#r(){i.addFlag("始まり");const t=await y(()=>import("./event.js"),[],import.meta.url);await w.say(...t.default.始まり)}#o(){const t=this.#t.pages.get("first");l.fadeOutAndPause(),p.ok().then(()=>{t.classList.add("show"),l.change("assets/sounds/bgm/信仰の残り香.mp3"),this.#i()})}#e(){const t=this.#t.pages.get("setting"),e=t.querySelector("#bgm-volume"),s=t.querySelector("#se-volume");e.value=String(i.getBGMVolume()),s.value=String(i.getSEVolume()),l.setVolume(i.getBGMVolume()/9),u.setVolume(i.getSEVolume()/9),e.oninput=()=>{i.setBGMVolume(+e.value),l.setVolume(i.getBGMVolume()/9)},s.oninput=()=>{i.setSEVolume(+s.value),u.setVolume(i.getSEVolume()/9),u.move.play()}}#a(){}#i(){const t=m.container;for(let e=0;e<30;e++){const s=document.createElement("div");s.classList.add("particle"),s.style.left=`${Math.random()*100}%`,s.style.width=`${20+Math.random()*30}px`,s.style.height=s.style.width,s.style.animationDuration=`${5+Math.random()*5}s`,s.style.animationDelay=`${Math.random()*10}s`,t.appendChild(s)}}#l(){i.getStageData().every(t=>t.cleared)&&m.container.querySelector("[data-link=story]")?.classList.remove("hidden")}}const v=Object.freeze(Object.defineProperty({__proto__:null,SceneTitle:f},Symbol.toStringTag,{value:"Module"}));export{r as P,b as S,u as a,v as b};
//# sourceMappingURL=SceneTitle.js.map
