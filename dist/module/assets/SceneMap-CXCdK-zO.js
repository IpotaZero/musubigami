const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SceneTitle-DHXt9q9_.js","../run.js","./SceneGame-DiCfbZkL.js"])))=>i.map(i=>d[i]);
import{D as o,L as p,_ as g,S,a as l,A as m}from"../run.js";import{S as _,P as f}from"./SceneTitle-DHXt9q9_.js";class E extends _{ready;#e=new f;#t;constructor(t){super(),this.#t=t,this.ready=this.#s()}async#s(){const t=await fetch("pages/map.html").then(e=>e.text());await this.#e.load(o.container,t,{history:["ch"+this.#t]}),this.#e.on("ch[012]",e=>{switch(e.getCurrentPageId()){case"ch0":this.#t=0;break;case"ch1":this.#t=1;break;case"ch2":this.#t=2;break}}),this.#r(),this.#i()}#r(){const t=p.getStageData();t[d.UNLOCK_ARROW_TRIGGERS.TO_CH1].cleared&&i.showChapterArrow(o.container,0),t[d.UNLOCK_ARROW_TRIGGERS.TO_CH2].cleared&&i.showChapterArrow(o.container,1),o.container.querySelectorAll("x-graph").forEach((a,c)=>{if(!a)return;const r=a.querySelector("svg"),s=r.querySelectorAll(".stage");i.showStageButton(r,0),s.forEach((w,h)=>{const u=d.getGlobalStageId(c,h);t[u]?.cleared&&(i.markupStar(r,w),i.showEdges(r,h),i.showConnectedStages(a,h)),w.onclick=()=>this.#o(u)})})}#i(){this.#e.before("back",async()=>{const{SceneTitle:t}=await g(async()=>{const{SceneTitle:e}=await import("./SceneTitle-DHXt9q9_.js").then(a=>a.a);return{SceneTitle:e}},__vite__mapDeps([0,1]),import.meta.url);return S.goto(()=>new t),!0})}async#o(t){const e=o.container.querySelector("#Z");e.classList.add("fade-in");const a=await fetch("../../assets/stories/start.json").then(r=>r.json());if(await l.say(...a[t]),e.classList.remove("fade-in"),await l.ask("やる?",["やる","やらない"])===0)switch(await this.#c(t),t){case 0:await this.#a(0);break;case 4:await this.#a(1);break;case 5:await this.#a(2);break}}async#c(t){const{SceneGame:e}=await g(async()=>{const{SceneGame:a}=await import("./SceneGame-DiCfbZkL.js");return{SceneGame:a}},__vite__mapDeps([2,1,0]),import.meta.url);await S.goto(()=>new e(this.#t,t),{fadeOut:m.valeOut,fadeIn:m.valeIn,msOut:800,msIn:800})}async#a(t){const e=await fetch("../../assets/stories/tutorial.json").then(a=>a.json());await l.say(...e[t])}}const d={STAGE_OFFSETS:[0,7,13],UNLOCK_ARROW_TRIGGERS:{TO_CH1:6,TO_CH2:12},getGlobalStageId(n,t){return t+(this.STAGE_OFFSETS[n]||0)}};class i{static markupStar(t,e){const a=e.getBBox(),c=a.x+a.width,r=a.y,s=document.createElementNS("http://www.w3.org/2000/svg","image");s.classList.add("star-icon"),s.setAttribute("href","assets/images/star.png"),s.setAttribute("x",String(c-12)),s.setAttribute("y",String(r-12)),s.setAttribute("width","24"),s.setAttribute("height","24"),t.appendChild(s)}static showEdges(t,e){t.querySelectorAll(`.path[data-from="${e}"], .path[data-to="${e}"]`).forEach(a=>a.classList.remove("hidden"))}static showStageButton(t,e){t.querySelectorAll(".stage")[e]?.classList.remove("hidden")}static showConnectedStages(t,e){t.getConnectedVertices(e).forEach(a=>a.classList.remove("hidden"))}static showChapterArrow(t,e){t.querySelectorAll(".map-arrow-right")[e]?.classList.remove("hidden")}}export{E as SceneMap};
//# sourceMappingURL=SceneMap-CXCdK-zO.js.map
