const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SceneTitle.js","../run.js","./SceneGame.js"])))=>i.map(i=>d[i]);
import{D as o,L as p,_ as g,S as d,a as h,A as m}from"../run.js";import{S as _,P as A}from"./SceneTitle.js";class b extends _{ready;#e=new A;#t;constructor(t){super(),this.#t=t,this.ready=this.#s()}async#s(){const t=await fetch("pages/map.html").then(e=>e.text());await this.#e.load(o.container,t,{history:["ch"+this.#t]}),this.#e.on("ch[012]",e=>{switch(e.getCurrentPageId()){case"ch0":this.#t=0;break;case"ch1":this.#t=1;break;case"ch2":this.#t=2;break}}),this.#r(),this.#i()}#r(){const t=p.getStageData();t[l.UNLOCK_ARROW_TRIGGERS.TO_CH1].cleared&&r.showChapterArrow(o.container,0),t[l.UNLOCK_ARROW_TRIGGERS.TO_CH2].cleared&&r.showChapterArrow(o.container,1),o.container.querySelectorAll("x-graph").forEach((a,i)=>{if(!a)return;const s=a.querySelector("svg"),S=s.querySelectorAll(".stage");r.showStageButton(s,0),S.forEach((u,n)=>{const w=l.getGlobalStageId(i,n);t[w]?.cleared&&(r.markupStar(s,u),r.showEdges(s,n),r.showConnectedStages(a,n)),u.onclick=()=>this.#o(w)})})}#i(){this.#e.before("back",async()=>{const{SceneTitle:t}=await g(async()=>{const{SceneTitle:e}=await import("./SceneTitle.js").then(a=>a.a);return{SceneTitle:e}},__vite__mapDeps([0,1]),import.meta.url);return d.goto(()=>new t),!0})}async#o(t){const e=await fetch("../../assets/stories/start.json").then(i=>i.json());if(await h.say(...e[t]),await h.ask("やる?",["やる","やらない"])===0)switch(await this.#c(t),t){case 0:await this.#a(0);break;case 4:await this.#a(1);break;case 5:await this.#a(2);break}}async#c(t){const{SceneGame:e}=await g(async()=>{const{SceneGame:a}=await import("./SceneGame.js");return{SceneGame:a}},__vite__mapDeps([2,1,0]),import.meta.url);await d.goto(()=>new e(this.#t,t),{fadeOut:m.valeOut,fadeIn:m.valeIn,msOut:800,msIn:800})}async#a(t){const e=await fetch("../../assets/stories/tutorial.json").then(a=>a.json());await h.say(...e[t])}}const l={STAGE_OFFSETS:[0,7,13],UNLOCK_ARROW_TRIGGERS:{TO_CH1:6,TO_CH2:12},getGlobalStageId(c,t){return t+(this.STAGE_OFFSETS[c]||0)}};class r{static markupStar(t,e){const a=Number(e.getAttribute("x")),i=Number(e.getAttribute("y")),s=document.createElementNS("http://www.w3.org/2000/svg","image");s.classList.add("star-icon"),s.setAttribute("href","assets/images/star.png"),s.setAttribute("x",String(a-12)),s.setAttribute("y",String(i-12)),s.setAttribute("width","24"),s.setAttribute("height","24"),t.appendChild(s)}static showEdges(t,e){t.querySelectorAll(`.path[data-from="${e}"], .path[data-to="${e}"]`).forEach(a=>a.classList.remove("hidden"))}static showStageButton(t,e){t.querySelectorAll(".stage")[e]?.classList.remove("hidden")}static showConnectedStages(t,e){t.getConnectedVertices(e).forEach(a=>a.classList.remove("hidden"))}static showChapterArrow(t,e){t.querySelectorAll(".map-arrow-right")[e]?.classList.remove("hidden")}}export{b as SceneMap};
//# sourceMappingURL=SceneMap.js.map
