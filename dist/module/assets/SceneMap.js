const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SceneTitle.js","../run.js","./SceneGame.js"])))=>i.map(i=>d[i]);
import{D as o,L as l,a as n,_ as g,S as m,A as S}from"../run.js";import{S as y,P as _,B as f}from"./SceneTitle.js";class E extends y{ready;#a=new _;#t;#s;constructor(t){super(),this.#t=t,this.ready=this.#r()}async end(){clearInterval(this.#s)}async#r(){const t=await fetch("assets/pages/map.html").then(e=>e.text());await this.#a.load(o.container,t,{history:["ch"+this.#t]}),this.#a.on("ch[012]",e=>{const a=e.getCurrentPageId();if(a==="ch1"&&!l.getFlags().includes("ch1")){this.#i();return}switch(a){case"ch0":this.#t=0;break;case"ch1":this.#t=1;break;case"ch2":this.#t=2;break}}),this.#o(),this.#n(),this.#l()}async#i(){const t=await fetch("../../assets/stories/event.json").then(e=>e.json());await n.say(...t.敵対),l.addFlag("ch1")}#o(){const t=l.getStageData();t[w.UNLOCK_ARROW_TRIGGERS.TO_CH1].cleared&&i.showChapterArrow(o.container,0),t[w.UNLOCK_ARROW_TRIGGERS.TO_CH2].cleared&&i.showChapterArrow(o.container,1),o.container.querySelectorAll("x-graph").forEach((a,r)=>{const s=a.querySelector("svg"),p=s.querySelectorAll(".stage");i.showStageButton(s,0),p.forEach((u,h)=>{const d=w.getGlobalStageId(r,h);t[d]?.cleared&&(i.markupStar(s,u),i.showEdges(s,h),i.showConnectedStages(a,h)),u.onclick=()=>this.#c(d)})})}#n(){this.#a.before("back",async()=>{const{SceneTitle:t}=await g(async()=>{const{SceneTitle:e}=await import("./SceneTitle.js").then(a=>a.b);return{SceneTitle:e}},__vite__mapDeps([0,1]),import.meta.url);return m.goto(()=>new t),!0})}async#c(t){const e=await fetch("../../assets/stories/story.json").then(r=>r.json());if(await n.say(...e[t].start),await n.ask("やる?",["やる","やらない"])===0)switch(await this.#h(t),t){case 0:await this.#e(0);break;case 2:await this.#e(1);break;case 5:await this.#e(2);break;case 7:await this.#e(3);break}}async#h(t){const{SceneGame:e}=await g(async()=>{const{SceneGame:a}=await import("./SceneGame.js").then(r=>r.S);return{SceneGame:a}},__vite__mapDeps([2,1,0]),import.meta.url);f.ffp("assets/sounds/bgm/why_was_faith_lost.mp3",{loop:!0,loopStartS:1.276}),await m.goto(()=>new e(this.#t,t),{fadeOut:S.valeOut,fadeIn:S.valeIn,msOut:850,msIn:850})}async#e(t){const e=await fetch("../../assets/stories/tutorial.json").then(a=>a.json());await n.say(...e[t])}#l(){o.container.querySelectorAll(".event").forEach((t,e)=>{t.onclick=async()=>{const a=await fetch("../../assets/stories/event.json").then(r=>r.json());await n.say(...a["event"+e])}})}}const w={STAGE_OFFSETS:[0,7,13],UNLOCK_ARROW_TRIGGERS:{TO_CH1:6,TO_CH2:12},getGlobalStageId(c,t){return t+(this.STAGE_OFFSETS[c]||0)}};class i{static markupStar(t,e){const a=Number(e.getAttribute("x")),r=Number(e.getAttribute("y")),s=document.createElementNS("http://www.w3.org/2000/svg","image");s.classList.add("star-icon"),s.setAttribute("href","assets/images/star.png"),s.setAttribute("x",String(a-12)),s.setAttribute("y",String(r-12)),s.setAttribute("width","24"),s.setAttribute("height","24"),t.appendChild(s)}static showEdges(t,e){t.querySelectorAll(`.path[data-from="${e}"], .path[data-to="${e}"]`).forEach(a=>a.classList.remove("hidden"))}static showStageButton(t,e){t.querySelectorAll(".stage")[e]?.classList.remove("hidden")}static showConnectedStages(t,e){t.getConnectedVertices(e).forEach(a=>a.classList.remove("hidden"))}static showChapterArrow(t,e){t.querySelectorAll(".map-arrow-right")[e]?.classList.remove("hidden")}}export{E as SceneMap};
//# sourceMappingURL=SceneMap.js.map
