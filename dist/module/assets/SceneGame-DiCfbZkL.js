const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SceneMap-CXCdK-zO.js","../run.js","./SceneTitle-DHXt9q9_.js"])))=>i.map(i=>d[i]);
import{D as p,_ as a,S as u,a as m,L as g}from"../run.js";import{S as f,P as _}from"./SceneTitle-DHXt9q9_.js";const o="http://www.w3.org/2000/svg";class l{onClear=()=>{};svg;pen=document.createElement("span");#t=0;#e=[];#a=[];#r=[];#s=[];#o=new AbortController;#i=!1;constructor(s=400,t=300){this.svg=document.createElementNS(o,"svg"),this.svg.setAttribute("viewBox",`${-s/2} ${-t/2} ${s} ${t}`),this.svg.style.display="block",this.svg.classList.add("game-svg");const e=document.createElementNS(o,"g");e.setAttribute("class","edges"),this.svg.appendChild(e);const r=document.createElementNS(o,"g");r.setAttribute("class","vertices"),this.svg.appendChild(r),this.pen.classList.add("game-pen"),this.svg.appendChild(l.#m(this.svg)),window.addEventListener("resize",()=>{this.#c()},{signal:this.#o.signal})}remove(){this.#o.abort()}render({vertices:s,edges:t}){this.#r=t;const e=this.svg.querySelector("g.edges"),r=this.svg.querySelector("g.vertices");for(;e.firstChild;)e.removeChild(e.firstChild);for(;r.firstChild;)r.removeChild(r.firstChild);for(const i of t){const n=s[i[0]],c=s[i[1]];if(!n||!c)continue;const h=this.#d(n,c,i);e.appendChild(h),this.#a.push(h)}for(const i of s){const n=this.#p(i);r.appendChild(n),this.#e.push(n)}this.#e.forEach((i,n)=>{i.addEventListener("click",()=>{this.#h(n)})}),this.#s=t.map(i=>i[2]??1),this.#n()}retry(){this.#i=!1,this.#t=0,this.#s=this.#r.map(s=>s[2]??1),this.#n()}#n(){this.#u(),this.#c(),this.#l()}#h(s){if(!this.#i){this.#t=s,this.#i=!0,this.#n();return}if(s===this.#t)return;const t=this.#r.findIndex((e,r)=>this.#s[r]===0?!1:e[3]?e[1]===this.#t&&e[0]===s:e[0]===this.#t&&e[1]===s||e[1]===this.#t&&e[0]===s);t!==-1&&(this.#s[t]--,this.#t=s,this.#n(),this.#s.every(e=>e===0)&&this.onClear())}#c(){if(!this.#i){this.pen.style.left="calc(100% - 13dvh)",this.pen.style.top="calc(100% - 13dvh)";return}const t=this.#e[this.#t].getBoundingClientRect();this.pen.style.left=`${t.x+t.width/2}px`,this.pen.style.top=`${t.y+t.height/2}px`}#l(){if(!this.#i){this.#e.forEach(s=>s.dataset.active="true");return}this.#e.forEach((s,t)=>{const e=this.#r.some((r,i)=>t===this.#t||this.#s[i]===0?!1:r[3]?r[1]===this.#t&&r[0]===t:r[0]===this.#t&&r[1]===t||r[1]===this.#t&&r[0]===t);s.dataset.active=String(e),s.dataset.current=String(t===this.#t)})}#u(){this.#a.forEach((s,t)=>{s.dataset.left=String(this.#s[t])})}#d(s,t,e){const r=document.createElementNS(o,"polyline");return r.setAttribute("points",`${s[0]},${s[1]} ${(s[0]+t[0])/2},${(s[1]+t[1])/2} ${t[0]},${t[1]}`),r.setAttribute("stroke","currentColor"),r.setAttribute("stroke-width","3"),r.setAttribute("stroke-linecap","round"),r.setAttribute("data-from",String(e[0])),r.setAttribute("data-to",String(e[1])),r.classList.add("edge"),e[3]&&r.setAttribute("marker-mid","url(#arrow-end)"),r}#p(s){const e=document.createElementNS(o,"rect");return e.setAttribute("width",String(48)),e.setAttribute("height",String(48)),e.setAttribute("x",String(s[0]-48/2)),e.setAttribute("y",String(s[1]-48/2)),e.setAttribute("fill","#f5f5f5"),e.setAttribute("stroke","#111"),e.setAttribute("stroke-width","0.5"),e.classList.add("vertex"),e}static#m(s){const t=document.createElementNS(s.namespaceURI,"marker");t.id="arrow-end",t.setAttribute("orient","auto"),t.setAttribute("markerWidth","4"),t.setAttribute("markerHeight","4"),t.setAttribute("refX","8"),t.setAttribute("refY","2");const e=document.createElementNS(s.namespaceURI,"path");return e.setAttribute("d",`M 4 0
             Q 2 1.3, 0 2
             Q 2 2.7, 4 4
             Z`),e.setAttribute("fill","currentColor"),t.appendChild(e),t}}class b extends f{ready;#t=new _;#e=new l;constructor(s,t){super(),this.ready=this.#a(s,t)}async end(){this.#e.remove()}async#a(s,t){const e=await fetch("pages/game.html").then(r=>r.text());await this.#t.load(p.container,e),this.#r(s,t),this.#s(s,t)}#r(s,t){this.#t.before("back",async()=>{const{SceneMap:e}=await a(async()=>{const{SceneMap:r}=await import("./SceneMap-CXCdK-zO.js");return{SceneMap:r}},__vite__mapDeps([0,1,2]),import.meta.url);u.goto(()=>new e(s))}),this.#t.before("next",async()=>{const{SceneMap:e}=await a(async()=>{const{SceneMap:i}=await import("./SceneMap-CXCdK-zO.js");return{SceneMap:i}},__vite__mapDeps([0,1,2]),import.meta.url);await u.goto(()=>new e(s));const r=await fetch(`../../assets/stories/end${t}.json`).then(i=>i.json());m.say(...r)}),this.#t.before("retry",async()=>(this.#e.retry(),!0))}async#s(s,t){const e=this.#t.pages.get("first"),r=e.querySelector("#stage-id");r.textContent=`Stage: ${s}-${t}`;const i=e.querySelector("#center");i.appendChild(this.#e.svg),i.appendChild(this.#e.pen);const n=Object.assign({"../stages/Stage0.ts":()=>a(()=>import("./Stage0-LigOCJLU.js"),[],import.meta.url),"../stages/Stage1.ts":()=>a(()=>import("./Stage1-D00Obuy6.js"),[],import.meta.url),"../stages/Stage2.ts":()=>a(()=>import("./Stage2-BaRasVGO.js"),[],import.meta.url),"../stages/Stage3.ts":()=>a(()=>import("./Stage3-ULsab4YM.js"),[],import.meta.url),"../stages/Stage4.ts":()=>a(()=>import("./Stage4-yV8CD0Pc.js"),[],import.meta.url),"../stages/Stage5.ts":()=>a(()=>import("./Stage5-i3OTAxsp.js"),[],import.meta.url),"../stages/Stage6.ts":()=>a(()=>import("./Stage6-OzFRfmOd.js"),[],import.meta.url),"../stages/Stage7.ts":()=>a(()=>import("./Stage7-OzFRfmOd.js"),[],import.meta.url)}),c=`../stages/Stage${t}.ts`,{stage:h}=await n[c]();this.#e.render(h());const d=e.querySelector("#followed");this.#e.onClear=()=>{g.setStageData(t,{cleared:!0}),e.querySelector("[data-link=next]").classList.add("fade-in"),d?.classList.add("fade")}}}export{b as SceneGame};
//# sourceMappingURL=SceneGame-DiCfbZkL.js.map
