{"version":3,"mappings":"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","names":["Dom","#check","LocalStorage","#KEY","#createDefaultData","#getData","json","#setData","data","stageId","stageData","flag","Awaits","container","ms","vale","resolve","abort","e","fn","SceneChanger","#currentScene","firstScene","newScene","showLoading","#showLoading","hideLoading","#hideLoading","fadeOut","fadeIn","msIn","msOut","done","showed","p","Graph","svg","#render","vertexId","vertices","edge","vertexElements","i","url","res","#renderGraph","edges","svgNS","line","x1","y1","x2","y2","x","y","index","rect","Serif","#container","#background","#window","#textContainer","#iconContainer","#mode","#resolve","#cue","#say","title","choices","#reset","choice","button","texts","command","SceneTitle","__vitePreload","n"],"ignoreList":[],"sources":["../../src/Dom.ts","../../src/LocalStorage.ts","../../src/utils/Awaits.ts","../../src/Scenes/SceneChanger.ts","../../src/utils/Graph.ts","../../src/utils/Serif.ts","../../src/run.ts"],"sourcesContent":["export class Dom {\r\n    static container: HTMLElement\r\n\r\n    static init() {\r\n        this.container = document.getElementById(\"container\")!\r\n        this.#check()\r\n    }\r\n\r\n    static #check() {\r\n        if (!this.container) {\r\n            throw new Error(\"Container element not found\")\r\n        }\r\n    }\r\n}\r\n","export class LocalStorage {\r\n    static readonly #KEY = \"musubigami\"\r\n\r\n    static #createDefaultData() {\r\n        return {\r\n            stageDataList: Array.from({ length: 3 * 7 }, () => ({ cleared: false })),\r\n            flags: [],\r\n        }\r\n    }\r\n\r\n    static #getData(): Data {\r\n        const json = localStorage.getItem(this.#KEY)\r\n        return json ? JSON.parse(json) : this.#createDefaultData()\r\n    }\r\n\r\n    static #setData(data: Data) {\r\n        localStorage.setItem(this.#KEY, JSON.stringify(data))\r\n    }\r\n\r\n    static getStageData(): StageData[] {\r\n        const data = this.#getData()\r\n        return data.stageDataList\r\n    }\r\n\r\n    static setStageData(stageId: number, stageData: StageData) {\r\n        const data = this.#getData()\r\n        data.stageDataList[stageId] = stageData\r\n        this.#setData(data)\r\n    }\r\n\r\n    static getFlags(): Flag[] {\r\n        const data = this.#getData()\r\n        return data.flags\r\n    }\r\n\r\n    static addFlag(flag: Flag) {\r\n        const data = this.#getData()\r\n\r\n        if (data.flags.includes(flag)) return\r\n\r\n        data.flags.push(flag)\r\n\r\n        this.#setData(data)\r\n    }\r\n\r\n    static clear() {\r\n        localStorage.removeItem(this.#KEY)\r\n    }\r\n}\r\n\r\ntype Data = {\r\n    stageDataList: StageData[]\r\n    flags: Flag[]\r\n}\r\n\r\ntype StageData = {\r\n    cleared: boolean\r\n}\r\n\r\ntype Flag = \"始まり\"\r\n","export class Awaits {\r\n    static async fadeOut(container: HTMLElement, ms: number = 200) {\r\n        container.style.transition = \"opacity 0s\"\r\n        container.style.pointerEvents = \"none\"\r\n\r\n        await Awaits.frame(() => {\r\n            container.style.opacity = \"1\"\r\n        })\r\n\r\n        await Awaits.frame(() => {\r\n            container.style.transition = `opacity ${ms}ms`\r\n        })\r\n\r\n        await Awaits.frame(() => {\r\n            container.style.opacity = \"0\"\r\n            container.style.pointerEvents = \"none\"\r\n        })\r\n\r\n        await Awaits.sleep(ms)\r\n    }\r\n\r\n    static async fadeIn(container: HTMLElement, ms: number = 200) {\r\n        container.style.transition = \"opacity 0s\"\r\n        container.style.pointerEvents = \"none\"\r\n\r\n        await Awaits.frame(() => {\r\n            container.style.opacity = \"0\"\r\n        })\r\n\r\n        await Awaits.frame(() => {\r\n            container.style.transition = `opacity ${ms}ms`\r\n        })\r\n\r\n        await Awaits.frame(() => {\r\n            container.style.opacity = \"1\"\r\n            container.style.pointerEvents = \"\"\r\n        })\r\n\r\n        await Awaits.sleep(ms)\r\n    }\r\n\r\n    static async valeOut(container: HTMLElement, ms: number = 200) {\r\n        const vale = document.createElement(\"div\")\r\n        vale.classList.add(\"vale\")\r\n        vale.style.transition = `left ${ms}ms cubic-bezier(0.37, 0, 0.63, 1)`\r\n\r\n        document.body.appendChild(vale)\r\n\r\n        await Awaits.frame()\r\n\r\n        await Awaits.frame(() => {\r\n            vale.style.left = \"0\"\r\n        })\r\n\r\n        await Awaits.sleep(ms)\r\n    }\r\n\r\n    static async valeIn(container: HTMLElement, ms: number = 200) {\r\n        const vale = document.querySelector<HTMLDivElement>(\".vale\")\r\n        if (!vale) return\r\n        vale.style.transition = `left ${ms}ms cubic-bezier(0.12, 0, 0.39, 0)`\r\n\r\n        await Awaits.frame(() => {\r\n            vale.style.left = \"calc(100dvw + 4em)\"\r\n        })\r\n        await Awaits.sleep(ms)\r\n\r\n        document.body.removeChild(vale)\r\n    }\r\n\r\n    static sleep(ms: number) {\r\n        return new Promise<void>((resolve) => {\r\n            setTimeout(resolve, ms)\r\n        })\r\n    }\r\n\r\n    static ok() {\r\n        const abort = new AbortController()\r\n\r\n        return new Promise<void>((resolve) => {\r\n            document.addEventListener(\r\n                \"click\",\r\n                () => {\r\n                    abort.abort()\r\n                    resolve()\r\n                },\r\n                { signal: abort.signal },\r\n            )\r\n\r\n            document.addEventListener(\r\n                \"keydown\",\r\n                (e) => {\r\n                    if ([\"KeyZ\", \"Enter\", \"Space\"].includes(e.code)) {\r\n                        abort.abort()\r\n                        resolve()\r\n                    }\r\n                },\r\n                { signal: abort.signal },\r\n            )\r\n        })\r\n    }\r\n\r\n    static key() {\r\n        const abort = new AbortController()\r\n\r\n        return new Promise<void>((resolve) => {\r\n            document.addEventListener(\r\n                \"click\",\r\n                () => {\r\n                    abort.abort()\r\n                    resolve()\r\n                },\r\n                { signal: abort.signal },\r\n            )\r\n\r\n            document.addEventListener(\r\n                \"keydown\",\r\n                (e) => {\r\n                    abort.abort()\r\n                    resolve()\r\n                },\r\n                { signal: abort.signal },\r\n            )\r\n        })\r\n    }\r\n\r\n    static frame(fn = () => {}) {\r\n        return new Promise<void>((resolve) =>\r\n            requestAnimationFrame(() => {\r\n                fn()\r\n                resolve()\r\n            }),\r\n        )\r\n    }\r\n}\r\n","import { Awaits } from \"../utils/Awaits.js\"\r\nimport { Scene } from \"./Scene.js\"\r\n\r\ntype FadeFunction = (container: HTMLElement, ms: number) => Promise<void>\r\n\r\nexport class SceneChanger {\r\n    static #currentScene: Scene\r\n\r\n    static init(firstScene: Scene) {\r\n        this.#currentScene = firstScene\r\n        return this.#currentScene.ready\r\n    }\r\n\r\n    static async goto(\r\n        newScene: () => Scene,\r\n        {\r\n            showLoading = this.#showLoading,\r\n            hideLoading = this.#hideLoading,\r\n            fadeOut = Awaits.fadeOut,\r\n            fadeIn = Awaits.fadeIn,\r\n            msIn = 500,\r\n            msOut = 500,\r\n        }: {\r\n            showLoading?: () => void\r\n            hideLoading?: () => void\r\n            fadeOut?: FadeFunction\r\n            fadeIn?: FadeFunction\r\n            msIn?: number\r\n            msOut?: number\r\n        } = {},\r\n    ) {\r\n        const container = document.getElementById(\"container\")!\r\n\r\n        await fadeOut(container, msIn)\r\n        await this.#currentScene.end()\r\n\r\n        let done = false\r\n        let showed = false\r\n\r\n        // 1秒タイマーを並行実行\r\n        Awaits.sleep(1000).then(() => {\r\n            if (!done) {\r\n                showLoading() // ローディング画面表示\r\n                showed = true\r\n            }\r\n        })\r\n\r\n        this.#currentScene = newScene()\r\n        await this.#currentScene.ready // メイン処理実行\r\n        done = true // 1秒以内に終わればローディングは表示されない\r\n\r\n        if (showed) {\r\n            hideLoading()\r\n        }\r\n\r\n        await fadeIn(container, msOut)\r\n    }\r\n\r\n    static #showLoading() {\r\n        const p = document.createElement(\"p\")\r\n        p.textContent = \"Loading...\"\r\n        p.classList.add(\"loading\")\r\n        document.body.appendChild(p)\r\n    }\r\n\r\n    static #hideLoading() {\r\n        document.querySelectorAll(\".loading\").forEach((e) => e.remove())\r\n    }\r\n}\r\n","export class Graph extends HTMLElement {\r\n    connectedCallback() {\r\n        const svgNS = \"http://www.w3.org/2000/svg\"\r\n        const svg = document.createElementNS(svgNS, \"svg\")\r\n        svg.setAttribute(\"viewBox\", \"0 0 400 300\")\r\n        this.appendChild(svg)\r\n\r\n        this.#render(svg)\r\n    }\r\n\r\n    getConnectedVertices(vertexId: number) {\r\n        const vertices: number[] = []\r\n\r\n        this.querySelectorAll<SVGLineElement>(`.path[data-from=\"${vertexId}\"]`).forEach((edge) => {\r\n            vertices.push(Number(edge.dataset[\"to\"]))\r\n        })\r\n\r\n        this.querySelectorAll<SVGLineElement>(`.path[data-to=\"${vertexId}\"]`).forEach((edge) => {\r\n            vertices.push(Number(edge.dataset[\"from\"]))\r\n        })\r\n\r\n        const vertexElements: SVGRectElement[] = Array.from(this.querySelectorAll(\".stage\"))\r\n\r\n        return vertices.map((i) => vertexElements[i])\r\n    }\r\n\r\n    #render(svg: SVGSVGElement) {\r\n        const url = this.getAttribute(\"src\")\r\n\r\n        if (url) {\r\n            fetch(url)\r\n                .then((res) => res.json())\r\n                .then((data: { vertices: [number, number][]; edges: [number, number][] }) => {\r\n                    this.#renderGraph(svg, data.vertices, data.edges)\r\n                })\r\n        }\r\n    }\r\n\r\n    #renderGraph(svg: SVGSVGElement, vertices: [number, number][], edges: [number, number][]) {\r\n        const svgNS = \"http://www.w3.org/2000/svg\"\r\n\r\n        // Clear existing content\r\n        while (svg.firstChild) {\r\n            svg.removeChild(svg.firstChild)\r\n        }\r\n\r\n        // Draw edges\r\n        edges.forEach((edge) => {\r\n            const line = document.createElementNS(svgNS, \"line\")\r\n            const [x1, y1] = vertices[edge[0]]\r\n            const [x2, y2] = vertices[edge[1]]\r\n            line.setAttribute(\"x1\", x1.toString())\r\n            line.setAttribute(\"y1\", y1.toString())\r\n            line.setAttribute(\"x2\", x2.toString())\r\n            line.setAttribute(\"y2\", y2.toString())\r\n            line.classList.add(\"path\", \"hidden\")\r\n            line.dataset[\"from\"] = `${edge[0]}`\r\n            line.dataset[\"to\"] = `${edge[1]}`\r\n            svg.appendChild(line)\r\n        })\r\n\r\n        // Draw vertices\r\n        vertices.forEach(([x, y], index) => {\r\n            const rect = document.createElementNS(svgNS, \"rect\")\r\n            rect.setAttribute(\"x\", (x - 16).toString())\r\n            rect.setAttribute(\"y\", (y - 16).toString())\r\n            rect.setAttribute(\"width\", \"32\")\r\n            rect.setAttribute(\"height\", \"32\")\r\n            rect.classList.add(\"stage\", \"hidden\")\r\n            svg.appendChild(rect)\r\n\r\n            // const text = document.createElementNS(svgNS, \"text\")\r\n            // text.setAttribute(\"x\", x.toString())\r\n            // text.setAttribute(\"y\", (y + 4).toString())\r\n            // text.setAttribute(\"text-anchor\", \"middle\")\r\n            // text.setAttribute(\"font-size\", \"1\")\r\n            // text.setAttribute(\"fill\", \"#111\")\r\n            // text.textContent = `${index}`\r\n            // svg.appendChild(text)\r\n        })\r\n    }\r\n}\r\n\r\ncustomElements.define(\"x-graph\", Graph)\r\n","import { Awaits } from \"./Awaits\"\r\n\r\nexport type SerifCommand = string | { type: \"character\"; icon: string } | { type: \"background\"; image: string }\r\n\r\nexport class Serif {\r\n    static readonly #container = document.createElement(\"div\")\r\n    static readonly #background = document.createElement(\"div\")\r\n    static readonly #window = document.createElement(\"div\")\r\n    static readonly #textContainer = document.createElement(\"div\")\r\n    static readonly #iconContainer = document.createElement(\"div\")\r\n\r\n    static #mode: \"say\" | \"ask\" = \"say\"\r\n\r\n    static #resolve = () => {}\r\n\r\n    static #cue: SerifCommand[] = []\r\n\r\n    static init() {\r\n        this.#background.id = \"serif-background\"\r\n        this.#container.appendChild(this.#background)\r\n\r\n        this.#window.id = \"serif-window\"\r\n        this.#container.appendChild(this.#window)\r\n\r\n        this.#iconContainer.id = \"serif-icon-container\"\r\n        this.#iconContainer.classList.add(\"hidden\")\r\n        this.#window.appendChild(this.#iconContainer)\r\n\r\n        this.#textContainer.id = \"serif-text-container\"\r\n        this.#textContainer.classList.add(\"text-end\")\r\n        this.#window.appendChild(this.#textContainer)\r\n\r\n        this.#container.id = \"serif-container\"\r\n        document.body.appendChild(this.#container)\r\n\r\n        this.#container.addEventListener(\"click\", () => {\r\n            if (this.#mode === \"say\") {\r\n                this.#say()\r\n            }\r\n        })\r\n\r\n        window.addEventListener(\"keydown\", (e) => {\r\n            if ([\"KeyZ\", \"Enter\", \"Space\"].includes(e.code)) {\r\n                if (this.#mode === \"say\") {\r\n                    this.#say()\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    static ask(title: string, choices: string[]): Promise<number> {\r\n        this.#mode = \"ask\"\r\n        this.#reset()\r\n\r\n        this.#textContainer.innerHTML = title + \"<br/>\"\r\n        this.#textContainer.classList.remove(\"fade-in\")\r\n        this.#textContainer.classList.remove(\"text-end\")\r\n\r\n        requestAnimationFrame(() => {\r\n            this.#textContainer.classList.add(\"fade-in\")\r\n        })\r\n\r\n        return new Promise<number>((resolve) => {\r\n            choices.forEach((choice, index) => {\r\n                const button = document.createElement(\"button\")\r\n                button.textContent = choice\r\n                button.addEventListener(\"click\", () => {\r\n                    this.#container.classList.remove(\"shown\")\r\n\r\n                    resolve(index)\r\n                })\r\n                this.#textContainer.appendChild(button)\r\n            })\r\n            this.#container.classList.add(\"shown\")\r\n        })\r\n    }\r\n\r\n    static say(...texts: SerifCommand[]) {\r\n        this.#mode = \"say\"\r\n        this.#reset()\r\n\r\n        this.#textContainer.innerHTML = \"\"\r\n        this.#container.classList.add(\"shown\")\r\n        this.#cue = texts\r\n        this.#textContainer.classList.add(\"text-end\")\r\n        this.#say()\r\n\r\n        const promise = new Promise<void>((resolve) => {\r\n            this.#resolve = resolve\r\n        })\r\n\r\n        return promise\r\n    }\r\n\r\n    static #say() {\r\n        if (this.#cue.length === 0) {\r\n            this.#container.classList.remove(\"shown\")\r\n            Awaits.sleep(200).then(() => {\r\n                this.#reset()\r\n            })\r\n            this.#resolve()\r\n            return\r\n        }\r\n\r\n        const command = this.#cue.shift()!\r\n\r\n        if (typeof command === \"string\") {\r\n            this.#textContainer.innerHTML = command\r\n            this.#textContainer.classList.remove(\"fade-in\")\r\n            requestAnimationFrame(() => {\r\n                this.#textContainer.classList.add(\"fade-in\")\r\n            })\r\n        } else if (command.type === \"character\") {\r\n            if (command.icon === \"none\") {\r\n                this.#iconContainer.classList.add(\"hidden\")\r\n            } else {\r\n                this.#iconContainer.innerHTML = `<img src=\"${command.icon}\" alt=\"\" />`\r\n                this.#iconContainer.classList.remove(\"hidden\")\r\n            }\r\n\r\n            this.#say()\r\n        } else if (command.type === \"background\") {\r\n            this.#background.innerHTML = `<img src=\"${command.image}\" alt=\"\" class=\"fade-in\"/>`\r\n            this.#say()\r\n        }\r\n    }\r\n\r\n    static #reset() {\r\n        this.#container.style.cursor = { \"say\": \"pointer\", \"ask\": \"default\" }[this.#mode]\r\n        this.#background.innerHTML = \"\"\r\n        this.#iconContainer.classList.add(\"hidden\")\r\n    }\r\n}\r\n","import { Dom } from \"./Dom\"\r\nimport { LocalStorage } from \"./LocalStorage\"\r\nimport { SceneChanger } from \"./Scenes/SceneChanger\"\r\n\r\nimport { Graph } from \"./utils/Graph\"\r\nimport { KeyboardOperation } from \"./utils/KeyboardOperation\"\r\nimport { Serif } from \"./utils/Serif\"\r\n\r\nGraph\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", async () => {\r\n    Serif.init()\r\n    Dom.init()\r\n    // KeyboardOperation.init()\r\n\r\n    const params = new URLSearchParams(window.location.search)\r\n\r\n    if (params.get(\"delete\") === \"true\") {\r\n        LocalStorage.clear()\r\n    }\r\n\r\n    const { SceneTitle } = await import(\"./Scenes/SceneTitle\")\r\n    SceneChanger.init(new SceneTitle())\r\n})\r\n\r\nwindow.addEventListener(\"contextmenu\", (e) => {\r\n    e.preventDefault()\r\n})\r\n"],"file":"run.js"}