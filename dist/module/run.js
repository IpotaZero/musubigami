const w="modulepreload",v=function(d,t){return new URL(d,t).href},g={},E=function(t,e,s){let r=Promise.resolve();if(e&&e.length>0){let m=function(a){return Promise.all(a.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};const i=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),c=o?.nonce||o?.getAttribute("nonce");r=m(e.map(a=>{if(a=v(a,s),a in g)return;g[a]=!0;const u=a.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(s)for(let p=i.length-1;p>=0;p--){const y=i[p];if(y.href===a&&(!u||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${f}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":w,u||(h.as="script"),h.crossOrigin="",h.href=a,c&&h.setAttribute("nonce",c),document.head.appendChild(h),u)return new Promise((p,y)=>{h.addEventListener("load",p),h.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${a}`)))})}))}function l(i){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i}return r.then(i=>{for(const o of i||[])o.status==="rejected"&&l(o.reason);return t().catch(l)})};class L{static container;static init(){this.container=document.getElementById("container"),this.#t()}static#t(){if(!this.container)throw new Error("Container element not found")}}class b{static#t="musubigami";static#i(){return{stageDataList:Array.from({length:21},()=>({cleared:!1})),flags:[]}}static#s(){const t=localStorage.getItem(this.#t);return t?JSON.parse(t):this.#i()}static#e(t){localStorage.setItem(this.#t,JSON.stringify(t))}static getStageData(){return this.#s().stageDataList}static setStageData(t,e){const s=this.#s();s.stageDataList[t]=e,this.#e(s)}static getFlags(){return this.#s().flags}static addFlag(t){const e=this.#s();e.flags.includes(t)||(e.flags.push(t),this.#e(e))}static clear(){localStorage.removeItem(this.#t)}}class n{static async fadeOut(t,e=200){t.style.transition="opacity 0s",t.style.pointerEvents="none",await n.frame(()=>{t.style.opacity="1"}),await n.frame(()=>{t.style.transition=`opacity ${e}ms`}),await n.frame(()=>{t.style.opacity="0",t.style.pointerEvents="none"}),await n.sleep(e)}static async fadeIn(t,e=200){t.style.transition="opacity 0s",t.style.pointerEvents="none",await n.frame(()=>{t.style.opacity="0"}),await n.frame(()=>{t.style.transition=`opacity ${e}ms`}),await n.frame(()=>{t.style.opacity="1",t.style.pointerEvents=""}),await n.sleep(e)}static async valeOut(t,e=200){const s=document.createElement("div");s.classList.add("vale"),s.style.transition=`left ${e}ms cubic-bezier(0.37, 0, 0.63, 1)`,document.body.appendChild(s),await n.frame(),await n.frame(()=>{s.style.left="0"}),await n.sleep(e)}static async valeIn(t,e=200){const s=document.querySelector(".vale");s&&(s.style.transition=`left ${e}ms cubic-bezier(0.12, 0, 0.39, 0)`,await n.frame(()=>{s.style.left="calc(100dvw + 4em)"}),await n.sleep(e),document.body.removeChild(s))}static sleep(t){return new Promise(e=>{setTimeout(e,t)})}static ok(){const t=new AbortController;return new Promise(e=>{document.addEventListener("click",()=>{t.abort(),e()},{signal:t.signal}),document.addEventListener("keydown",s=>{["KeyZ","Enter","Space"].includes(s.code)&&(t.abort(),e())},{signal:t.signal})})}static key(){const t=new AbortController;return new Promise(e=>{document.addEventListener("click",()=>{t.abort(),e()},{signal:t.signal}),document.addEventListener("keydown",s=>{t.abort(),e()},{signal:t.signal})})}static frame(t=()=>{}){return new Promise(e=>requestAnimationFrame(()=>{t(),e()}))}}class S{static#t;static init(t){return this.#t=t,this.#t.ready}static async goto(t,{showLoading:e=this.#i,hideLoading:s=this.#s,fadeOut:r=n.fadeOut,fadeIn:l=n.fadeIn,msIn:i=500,msOut:o=500}={}){const c=document.getElementById("container");await r(c,i),await this.#t.end();let m=!1,a=!1;n.sleep(1e3).then(()=>{m||(e(),a=!0)}),this.#t=t(),await this.#t.ready,m=!0,a&&s(),await l(c,o)}static#i(){const t=document.createElement("p");t.textContent="Loading...",t.classList.add("loading"),document.body.appendChild(t)}static#s(){document.querySelectorAll(".loading").forEach(t=>t.remove())}}class C extends HTMLElement{connectedCallback(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("viewBox","0 0 400 300"),this.appendChild(e),this.#t(e)}getConnectedVertices(t){const e=[];this.querySelectorAll(`.path[data-from="${t}"]`).forEach(r=>{e.push(Number(r.dataset.to))}),this.querySelectorAll(`.path[data-to="${t}"]`).forEach(r=>{e.push(Number(r.dataset.from))});const s=Array.from(this.querySelectorAll(".stage"));return e.map(r=>s[r])}#t(t){const e=this.getAttribute("src");e&&fetch(e).then(s=>s.json()).then(s=>{this.#i(t,s.vertices,s.edges)})}#i(t,e,s){const r="http://www.w3.org/2000/svg";for(;t.firstChild;)t.removeChild(t.firstChild);s.forEach(l=>{const i=document.createElementNS(r,"line"),[o,c]=e[l[0]],[m,a]=e[l[1]];i.setAttribute("x1",o.toString()),i.setAttribute("y1",c.toString()),i.setAttribute("x2",m.toString()),i.setAttribute("y2",a.toString()),i.classList.add("path","hidden"),i.dataset.from=`${l[0]}`,i.dataset.to=`${l[1]}`,t.appendChild(i)}),e.forEach(([l,i],o)=>{const c=document.createElementNS(r,"rect");c.setAttribute("x",(l-16).toString()),c.setAttribute("y",(i-16).toString()),c.setAttribute("width","32"),c.setAttribute("height","32"),c.classList.add("stage","hidden"),t.appendChild(c)})}}customElements.define("x-graph",C);class k{static#t=document.createElement("div");static#i=document.createElement("div");static#s=document.createElement("div");static#e=document.createElement("div");static#n=document.createElement("div");static#a="say";static#l=()=>{};static#o=[];static init(){this.#i.id="serif-background",this.#t.appendChild(this.#i),this.#s.id="serif-window",this.#t.appendChild(this.#s),this.#n.id="serif-icon-container",this.#n.classList.add("hidden"),this.#s.appendChild(this.#n),this.#e.id="serif-text-container",this.#e.classList.add("text-end"),this.#s.appendChild(this.#e),this.#t.id="serif-container",document.body.appendChild(this.#t),this.#t.addEventListener("click",()=>{this.#a==="say"&&this.#r()}),window.addEventListener("keydown",t=>{["KeyZ","Enter","Space"].includes(t.code)&&this.#a==="say"&&this.#r()})}static ask(t,e){return this.#a="ask",this.#c(),this.#e.innerHTML=t+"<br/>",this.#e.classList.remove("fade-in"),this.#e.classList.remove("text-end"),requestAnimationFrame(()=>{this.#e.classList.add("fade-in")}),new Promise(s=>{e.forEach((r,l)=>{const i=document.createElement("button");i.textContent=r,i.addEventListener("click",()=>{this.#t.classList.remove("shown"),s(l)}),this.#e.appendChild(i)}),this.#t.classList.add("shown")})}static say(...t){return this.#a="say",this.#c(),this.#e.innerHTML="",this.#t.classList.add("shown"),this.#o=t,this.#e.classList.add("text-end"),this.#r(),new Promise(s=>{this.#l=s})}static#r(){if(this.#o.length===0){this.#t.classList.remove("shown"),n.sleep(200).then(()=>{this.#c()}),this.#l();return}const t=this.#o.shift();typeof t=="string"?(this.#e.innerHTML=t,this.#e.classList.remove("fade-in"),requestAnimationFrame(()=>{this.#e.classList.add("fade-in")})):t.type==="character"?(t.icon==="none"?this.#n.classList.add("hidden"):(this.#n.innerHTML=`<img src="${t.icon}" alt="" />`,this.#n.classList.remove("hidden")),this.#r()):t.type==="background"&&(this.#i.innerHTML=`<img src="${t.image}" alt="" class="fade-in"/>`,this.#r())}static#c(){this.#t.style.cursor={say:"pointer",ask:"default"}[this.#a],this.#i.innerHTML="",this.#n.classList.add("hidden")}}document.addEventListener("DOMContentLoaded",async()=>{k.init(),L.init(),new URLSearchParams(window.location.search).get("delete")==="true"&&b.clear();const{SceneTitle:t}=await E(async()=>{const{SceneTitle:e}=await import("./assets/SceneTitle-DHXt9q9_.js").then(s=>s.a);return{SceneTitle:e}},[],import.meta.url);S.init(new t)});window.addEventListener("contextmenu",d=>{d.preventDefault()});export{n as A,L as D,b as L,S,E as _,k as a};
//# sourceMappingURL=run.js.map
