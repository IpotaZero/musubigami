const v="modulepreload",L=function(d,t){return new URL(d,t).href},p={},S=function(t,e,s){let r=Promise.resolve();if(e&&e.length>0){let m=function(n){return Promise.all(n.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};const i=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),c=o?.nonce||o?.getAttribute("nonce");r=m(e.map(n=>{if(n=L(n,s),n in p)return;p[n]=!0;const u=n.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(s)for(let y=i.length-1;y>=0;y--){const g=i[y];if(g.href===n&&(!u||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${f}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":v,u||(h.as="script"),h.crossOrigin="",h.href=n,c&&h.setAttribute("nonce",c),document.head.appendChild(h),u)return new Promise((y,g)=>{h.addEventListener("load",y),h.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${n}`)))})}))}function l(i){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i}return r.then(i=>{for(const o of i||[])o.status==="rejected"&&l(o.reason);return t().catch(l)})};class E{static container;static init(){this.container=document.getElementById("container"),this.#t()}static#t(){if(!this.container)throw new Error("Container element not found")}}class w{static#t="musubigami";static#s(){return{stageDataList:Array.from({length:21},()=>({cleared:!1})),flags:[]}}static#i(){const t=localStorage.getItem(this.#t);return t?JSON.parse(t):this.#s()}static#a(t){localStorage.setItem(this.#t,JSON.stringify(t))}static getStageData(){return this.#i().stageDataList}static setStageData(t,e){const s=this.#i();s.stageDataList[t]=e,this.#a(s)}static getFlags(){return this.#i().flags}static addFlag(t){const e=this.#i();e.flags.includes(t)||(e.flags.push(t),this.#a(e))}static clear(){localStorage.removeItem(this.#t)}static allWin(){for(let t=0;t<21;t++)this.setStageData(t,{cleared:!0})}}window.LocalStorage=w;class a{static async fadeOut(t,e=200){t.style.transition="opacity 0s",t.style.pointerEvents="none",await a.frame(()=>{t.style.opacity="1"}),await a.frame(()=>{t.style.transition=`opacity ${e}ms`}),await a.frame(()=>{t.style.opacity="0",t.style.pointerEvents="none"}),await a.sleep(e)}static async fadeIn(t,e=200){t.style.transition="opacity 0s",t.style.pointerEvents="none",await a.frame(()=>{t.style.opacity="0"}),await a.frame(()=>{t.style.transition=`opacity ${e}ms`}),await a.frame(()=>{t.style.opacity="1",t.style.pointerEvents=""}),await a.sleep(e)}static async valeOut(t,e=200){const s=document.createElement("div");s.classList.add("vale"),s.style.transition=`left ${e}ms cubic-bezier(0.37, 0, 0.63, 1)`,document.body.appendChild(s),await a.frame(),await a.frame(()=>{s.style.left="0"}),await a.sleep(e)}static async valeIn(t,e=200){const s=document.querySelector(".vale");s&&(s.style.transition=`left ${e}ms cubic-bezier(0.12, 0, 0.39, 0)`,await a.frame(()=>{s.style.left="calc(100dvw + 4em)"}),await a.sleep(e),document.body.removeChild(s))}static sleep(t){return new Promise(e=>{setTimeout(e,t)})}static ok(){const t=new AbortController;return new Promise(e=>{document.addEventListener("click",()=>{t.abort(),e()},{signal:t.signal}),document.addEventListener("keydown",s=>{["KeyZ","Enter","Space"].includes(s.code)&&(t.abort(),e())},{signal:t.signal})})}static key(){const t=new AbortController;return new Promise(e=>{document.addEventListener("click",()=>{t.abort(),e()},{signal:t.signal}),document.addEventListener("keydown",s=>{t.abort(),e()},{signal:t.signal})})}static frame(t=()=>{}){return new Promise(e=>requestAnimationFrame(()=>{t(),e()}))}}class b{static#t;static init(t){return this.#t=t,this.#t.ready}static async goto(t,{showLoading:e=this.#s,hideLoading:s=this.#i,fadeOut:r=a.fadeOut,fadeIn:l=a.fadeIn,msIn:i=500,msOut:o=500}={}){const c=document.getElementById("container");await r(c,i),await this.#t.end();let m=!1,n=!1;a.sleep(1e3).then(()=>{m||(e(),n=!0)}),this.#t=t(),await this.#t.ready,m=!0,n&&s(),await l(c,o)}static#s(){const t=document.createElement("p");t.textContent="Loading...",t.classList.add("loading"),document.body.appendChild(t)}static#i(){document.querySelectorAll(".loading").forEach(t=>t.remove())}}class C extends HTMLElement{connectedCallback(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("viewBox","0 0 400 300"),this.appendChild(e),this.#t(e)}getConnectedVertices(t){const e=[];this.querySelectorAll(`.path[data-from="${t}"]`).forEach(r=>{e.push(Number(r.dataset.to))}),this.querySelectorAll(`.path[data-to="${t}"]`).forEach(r=>{e.push(Number(r.dataset.from))});const s=Array.from(this.querySelectorAll(".stage"));return e.map(r=>s[r])}#t(t){const e=this.getAttribute("src");e&&fetch(e).then(s=>s.json()).then(s=>{this.#s(t,s.vertices,s.edges)})}#s(t,e,s){const r="http://www.w3.org/2000/svg";for(;t.firstChild;)t.removeChild(t.firstChild);s.forEach(l=>{const i=document.createElementNS(r,"line"),[o,c]=e[l[0]],[m,n]=e[l[1]];i.setAttribute("x1",o.toString()),i.setAttribute("y1",c.toString()),i.setAttribute("x2",m.toString()),i.setAttribute("y2",n.toString()),i.classList.add("path","hidden"),i.dataset.from=`${l[0]}`,i.dataset.to=`${l[1]}`,t.appendChild(i)}),e.forEach(([l,i],o)=>{const c=document.createElementNS(r,"rect");c.setAttribute("x",(l-16).toString()),c.setAttribute("y",(i-16).toString()),c.setAttribute("width","32"),c.setAttribute("height","32"),c.classList.add("stage","hidden"),t.appendChild(c)})}}customElements.define("x-graph",C);class k{static#t=document.createElement("div");static#s;static#i;static#a;static#e;static#o;static#n="say";static#d=()=>{};static#c=[];static init(){this.#t.innerHTML=`
            <div id="serif-background"></div>
            <div id="serif-window">
                <div id="serif-icon-container" class="hidden"></div>
                <div id="serif-text-container" class="text-end"></div>
                <span id="serif-Z">[Z]長押しでスキップ</span>
            </div>
        `,this.#s=this.#t.querySelector("#serif-background"),this.#i=this.#t.querySelector("#serif-window"),this.#a=this.#t.querySelector("#serif-icon-container"),this.#e=this.#t.querySelector("#serif-text-container"),this.#o=this.#t.querySelector("#serif-Z"),this.#t.id="serif-container",document.body.appendChild(this.#t),this.#t.addEventListener("click",()=>{this.#n==="say"&&this.#r()}),window.addEventListener("keydown",t=>{["KeyZ","Enter","Space"].includes(t.code)&&this.#n==="say"&&this.#r()})}static ask(t,e){return this.#n="ask",this.#o.classList.add("hidden"),this.#l(),this.#e.innerHTML=t+"<br/>",this.#e.classList.remove("fade-in"),this.#e.classList.remove("text-end"),requestAnimationFrame(()=>{this.#e.classList.add("fade-in")}),new Promise(s=>{e.forEach((r,l)=>{const i=document.createElement("button");i.textContent=r,i.addEventListener("click",()=>{this.#t.classList.remove("shown"),s(l)}),this.#e.appendChild(i)}),this.#t.classList.add("shown")})}static say(...t){return this.#n="say",this.#o.classList.remove("hidden"),this.#l(),this.#e.innerHTML="",this.#t.classList.add("shown"),this.#c=t,this.#e.classList.add("text-end"),this.#r(),new Promise(s=>{this.#d=s})}static#r(){if(this.#c.length===0){this.#t.classList.remove("shown"),a.sleep(200).then(()=>{this.#l()}),this.#d();return}const t=this.#c.shift();typeof t=="string"?(this.#e.innerHTML=t,this.#e.classList.remove("fade-in"),requestAnimationFrame(()=>{this.#e.classList.add("fade-in")})):t.type==="character"?(t.icon==="none"?this.#a.classList.add("hidden"):(this.#a.innerHTML=`<img src="${t.icon}" alt="" />`,this.#a.classList.remove("hidden")),this.#r()):t.type==="background"&&(this.#s.innerHTML=`<img src="${t.image}" alt="" class="fade-in"/>`,this.#r())}static#l(){this.#t.style.cursor={say:"pointer",ask:"default"}[this.#n],this.#s.innerHTML="",this.#a.classList.add("hidden")}}document.addEventListener("DOMContentLoaded",async()=>{k.init(),E.init(),new URLSearchParams(window.location.search).get("delete")==="true"&&w.clear();const{SceneTitle:t}=await S(async()=>{const{SceneTitle:e}=await import("./assets/SceneTitle.js").then(s=>s.a);return{SceneTitle:e}},[],import.meta.url);b.init(new t)});window.addEventListener("contextmenu",d=>{d.preventDefault()});export{a as A,E as D,w as L,b as S,S as _,k as a};
//# sourceMappingURL=run.js.map
